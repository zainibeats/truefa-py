# Dockerfile.windows
# Windows container for testing TrueFA-Py executables in a clean environment
# Note: This requires Docker Desktop with Windows containers enabled

# Use Windows Server Core as the base image
FROM mcr.microsoft.com/windows/servercore:ltsc2022

# Set shell to PowerShell
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';"]

# Install Visual C++ Redistributable (required dependency)
RUN Invoke-WebRequest -Uri 'https://aka.ms/vs/17/release/vc_redist.x64.exe' -OutFile 'C:/vc_redist.exe'
RUN Start-Process 'C:/vc_redist.exe' -ArgumentList '/quiet /norestart' -Wait
RUN Remove-Item 'C:/vc_redist.exe' -Force

# Create app directory
RUN mkdir C:/app

# Copy application files
COPY dist/ C:/app/dist/
COPY dev-tools/docker/test_script.ps1 C:/run_test.ps1

# Set the entrypoint to run the test script
ENTRYPOINT ["powershell.exe", "-ExecutionPolicy", "Bypass", "-File", "C:/run_test.ps1"]
